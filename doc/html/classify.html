<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.15.2: http://docutils.sourceforge.net/" />
<title>classify.txt</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document">


<p>b'=====================nGamera classifier APIn=====================nn**Last modified**: June 03, 2019nn.. contents::nn.. role:: raw-html(raw)n   :format: htmln.. footer:: <a href="#id1"><span class="problematic" id="id2">:raw-html:`&lt;div style=&quot;text-align:right;&quot;&gt;For contact information, see &lt;a href=&quot;http://gamera.informatik.hsnr.de/contact.html&quot;&gt;http://gamera.informatik.hsnr.de/contact.html&lt;/a&gt;&lt;/div&gt;`</span></a>nnnIntroductionn------------nnFor manual training of a classifier, you will generally want to usenthe <a href="#id19"><span class="problematic" id="id20">`interactive classifier GUI`__</span></a>.  This document describes thenprogramming API that is used by scripts that make use of a classifier.nn.. __: gui.html#interactive-classifier-windownnAt present, Gamera supports segmentation-based image classification.nThis means that the page image is first segmented into individualnconnected components (or glyphs).  Each of these glyphs has a numbernof features generated from it.  These features (collectively called an&quot;feature vector&quot;) are then used inside a classifier which, using andatabase of training data, identifies the glyph.nnInteractive vs. Noninteractive classifiersn''''''''''''''''''''''''''''''''''''''''''nnAll classifiers in Gamera support the same core Classifier API (interface), sonthey are interchangeable.  There is an importantndistinction between two families of classifiers, however:nnInteractive classifiern  An interactive classifier can have training examples added to it inn  real time, and the results used immediately to classify glyphs.n  Interactive classifiers are useful during the training process sincen  the classifier can be &quot;boot strapped&quot; with a few examples and refinedn  interactively. nnNoninteractive classifiern  Noninteractive classifiers take a complete database ofn  training data and then create an optimised data structure forn  classification.  Because building that data structure can take an  considerable amount of time, new training examples cannot be addedn  on the fly.  In addition, noninteractive classifiers aren  serializable to binary classifier-specific file formats, which saven  and load much faster than the Gamera XML format.nnTypes of classifiersn''''''''''''''''''''nnWithin each of these families, different classifiers are available.nThese &quot;concrete&quot; classifiers have additional methods specific to thenparticular classifier type.  The currently implemented classifiersnare all <em>k</em> - nearest-neighbor, but we plan to add other classifiersnas needed.nn - <a href="#id29"><span class="problematic" id="id30">kNNInteractive_</span></a>n     Interactive <em>k</em> nearest neighbor classifier.nn - <a href="#id31"><span class="problematic" id="id32">kNNNonInteractive_</span></a>n     Noninteractive <em>k</em> nearest neighbor classifier.  The weights ofn     the dimensions can be optimised using a genetic algorithm.n     To learn more about applying genetic algorithms for feature selection,n     see the <a href="#id19"><span class="problematic" id="id21">`Evolutionary Optimization Module documentation`__</span></a>.nn.. __: ga_optimization.htmlnnImage properties related to classificationn------------------------------------------nnClassification result are stored with the image. Some interface functionsnfor storing and querying the classification result are describednin the <a href="#id19"><span class="problematic" id="id22">`classification plugin documentation`__</span></a>.nn.. __: plugins.html#classificationnnn``id_name``n'''''''''''nnThe class name of a glyph is stored in the member variablen``id_name``.  This variable is actually a list of possiblenclassifications, so that a classifier can return a number of differentnpossibilities with different confidences. Each classification entrynis a tuple of the form (float <em>confidence</em>, string <em>name</em>), wherenthe &quot;confidence&quot; measure is of the type CONFIDENCE_DEFAULTn(see the <a href="#id19"><span class="problematic" id="id23">`confidence property`__</span></a> below).nn.. __: #confidencennFor example, if among the k nearest neighbor of the imagenthere are training samples both from class 'lower.b' andn'lower.d', its <tt class="docutils literal">id_name</tt> variable might be:nn.. code:: Pythonn  n  [(0.0879, 'lower.b'), (0.0012, 'lower.d')]nnThe first entry in <tt class="docutils literal">id_name</tt> is always the class decision madenby the classifier, so the other entries can (and should) generallynbe ignored. Due to the simplistic definition of the nCONFIDENCE_DEFAULT measure, the decision made by the classifiernmust not necessarily have the highest &quot;confidence&quot;, nor donthe values of all &quot;confidences&quot; add to one.nnn``classification_state``n''''''''''''''''''''''''nnHow a glyph was classified is managed by the <tt class="docutils literal">classification_state</tt>nmember variable.  It can be one of the following values:nn  +----------+--------------+-----------------------------------------------------+n  | Color    | Constant     | Description                                         <a href="#id3"><span class="problematic" id="id4">|\n  +==========+==============+=====================================================+\n  | |UColor|</span></a> | UNCLASSIFIED | The connected component is completely unclassified. <a href="#id5"><span class="problematic" id="id6">|\n  | (white)  |              |                                                     |\n  +----------+--------------+-----------------------------------------------------+\n  | |AColor|</span></a> | AUTOMATIC    | The connected component was classified by the       | n  | (red)    |              | automatic classifier using training data.           <a href="#id7"><span class="problematic" id="id8">|\n  +----------+--------------+-----------------------------------------------------+\n  | |HColor|</span></a> | HEURISTIC    | The connected component was classified by some      <a href="#id9"><span class="problematic" id="id10">|\n  | (yellow) |              | heuristic (non-exemplar-based) process.             |\n  +----------+--------------+-----------------------------------------------------+\n  | |MColor|</span></a> | MANUAL       | The connected component was classified by a human.  <a href="#id11"><span class="problematic" id="id12">|\n  | (green)  |              |                                                     |\n  +----------+--------------+-----------------------------------------------------+\n\n.. |UColor|</span></a> image:: images/unclassified_color.pngn.. <a href="#id13"><span class="problematic" id="id14">|AColor|</span></a> image:: images/autoclassified_color.pngn.. <a href="#id15"><span class="problematic" id="id16">|HColor|</span></a> image:: images/heuristicclassified_color.pngn.. <a href="#id17"><span class="problematic" id="id18">|MColor|</span></a> image:: images/manualclassified_color.pngnnn``confidence``n''''''''''''''nnDifferent confidence measures for the main class id are storednin the member variable <tt class="docutils literal">confidence</tt>. This is a map ('dictionary' innpython lingo) with a confidence type as key. The possible confidencentype constants are defined in <tt class="docutils literal">gamera.gameracore</tt> and have the nfollowing meaning:nn  <tt class="docutils literal">CONFIDENCE_DEFAULT</tt>nn     (1-<em>dist</em>/<em>max_dist</em>)^10, where <em>dist</em> is the distance to n     the closest prototype of the main class, and <em>max_dist</em> isn     the distance to the farthest prototype of the entire trainingn     population. This &quot;confidence&quot; is always between 0.0 and 1.0,n     where 1.0 only occurs for feature values that exactly match an     training sample.nn  <tt class="docutils literal">CONFIDENCE_KNNFRACTION</tt>nn     Fraction of samples belonging to main class among the kn     nearest neighbors. Makes only sense for k &gt; 1.nn  <tt class="docutils literal">CONFIDENCE_INVERSEWEIGHT</tt>nn     Dudani's weighted average distance to the main class withn     each distance weighted inversely. Makes only sense for k &gt; 1.nn  <tt class="docutils literal">CONFIDENCE_LINEARWEIGHT</tt>nn     Dudani's weighted average distance to the main class withn     each distance weighted linearly between the closest neighborn     (weight one) and the k-th nearest neighbor (weight zero).n     Makes only sense for k &gt; 1.nn  <tt class="docutils literal">CONFIDENCE_NUN</tt>nn     Dasarathy's &quot;nearest unlike neighbor&quot; measure. Let <em>dnn</em> denoten     the distance to the closest prototype of then     main class (nearest neighbor) and <em>dnun</em> the distance ton     the closest prototype of the remaining classes (nearest unliken     neighbor). Then the NUN confidence measure is (1-<em>dnn</em>/<em>dnun</em>).nn  <tt class="docutils literal">CONFIDENCE_NNDISTANCE</tt>nn     Absolute distance to the nearest neighbor. This can taken     arbitrary values and is in itself meaningless, but can be usefuln     for distance rejection.nn  <tt class="docutils literal">CONFIDENCE_AVGDISTANCE</tt>nn     Average distance to the k nearest neighbors. This can taken     arbitrary values and is in itself meaningless, but can be usefuln     for distance rejection. For k = 1, this is identical ton     <tt class="docutils literal">CONFIDENCE_NNDISTANCE</tt>.nnThe <tt class="docutils literal">confidence</tt> map is only filled for automatically classifiednglyphs. Which confidence types are actually written to the confidencenmap depends on the <tt class="docutils literal">confidence_types</tt> property of the classifier.nSo when the list <tt class="docutils literal">Classifier.confidence_types</tt> is empty, nonconfidence values will be written to <tt class="docutils literal">Image.confidence</tt>.nnReference:nn    C. Dalitz:n    <a href="#id19"><span class="problematic" id="id24">`Reject Options and Confidence Measures for kNN Classifiers.`__</span></a>n    In C. Dalitz (Ed.): &quot;Document Image Analysis with the Gamera Framework.&quot;n    Schriftenreihe des Fachbereichs Elektrotechnik und Informatik,n    Hochschule Niederrhein, vol. 8, pp. 16-38, Shaker Verlag (2009) nn.. __: <a class="reference external" href="http://lionel.kr.hsnr.de/~dalitz/data/publications/sr09-knn-rejection.pdfnnMethodsn'''''''nnImages">http://lionel.kr.hsnr.de/~dalitz/data/publications/sr09-knn-rejection.pdfnnMethodsn'''''''nnImages</a> have a number of methods for managing their classificationnstate.  Use of these methods is highly recommended over changing then``id_name`` variable directly.  These methods are documented in then`classification section of the plugin documentation`__.nn.. __: plugins.html#classificationnnThe classifier interfacen------------------------nnThis section describes each method of the classifier interface.nThe base class for all classifiers is <tt class="docutils literal">Classifier</tt>, from whichntwo classes <tt class="docutils literal">NonInteractiveClassifier</tt> and <tt class="docutils literal">InteractiveClassifier</tt>nare derived. As noninteractive classifiers are more limitednin their interface, this divides the methods into two categories:nnCoren  Methods available to all classifiersnnInteractiven  Methods available only to interactive classifiersnnCoren''''nnThe following methods and properties are available to all classifiers.nnPropertiesn``````````nnEach classifier has the following member variables:nn  <tt class="docutils literal">_database</tt>n    List of glyphs used as training data. This is a private propertyn    that can only be accessed through the methods <tt class="docutils literal">get_glyphs</tt> n    and <tt class="docutils literal">set_glyphs</tt>, or it is set in the constructor or withn    <tt class="docutils literal">from_xml_filename</tt>. Note that the return value of <tt class="docutils literal">get_glyphs</tt>n    must be converted to a list with <tt class="docutils literal"><span class="pre">list(classifier.get_glyphs())</span></tt>.nn  <tt class="docutils literal">confidence_types</tt>n    List of confidence types that are to be computed during n    classification. The confidence types must be from then    predefined <a href="#id19"><span class="problematic" id="id25">`confidence constants`__</span></a>.n    n.. __: #confidencennnInitializationn``````````````nnAs the base class <tt class="docutils literal">Classifier</tt> does not have an explicit constructor,nthe constructor of <tt class="docutils literal">NonInteractiveClassifier</tt> is described here.nn.. docstring:: gamera.classify NonInteractiveClassifier __init__ nnClassificationn``````````````nnThe following methods deal with classifying glyphs on an individual level.nn.. docstring:: gamera.classify NonInteractiveClassifier classify_glyph_automatic classify_list_automatic classify_and_update_list_automatic guess_glyph_automaticn.. docstring:: gamera.knn _kNNBase classify_with_imagesnnGroupingn````````nnOften, characters do not cleanly correspond to connected components.nFor instance, broken or degraded printing may disconnect parts of ancharacter, or characters, such as <em>i</em> may always be made up of twonconnected components.  The grouping algorithm is designed to deal withnthose cases.  It attempts to group connected components with othersnnearby in order to create groupings that are more like glyphs in thendatabase.  Needless to say, this approach is much slower than then&quot;one-connected-component-at-a-time&quot; approach, but can producenconsiderably better results on certain images.nnTo train for grouping, images corresponding to the entire characternmust exist in the database.  For instance, in the Gamera GUI, onenwould select both the dot and stem of a lower-case <em>i</em> and train it asn``_group.lower.i``.  This will join the two connected components intona single image and then add it to the database.nnThe algorithm is described in more detail in our paper on <a href="#id19"><span class="problematic" id="id26">`correcting\nbroken characters`__</span></a> (PDF).nn.. __: <a class="reference external" href="http://gamera.informatik.hsnr.de/publications/droettboom_broken_03.pdfnn">http://gamera.informatik.hsnr.de/publications/droettboom_broken_03.pdfnn</a>.. docstring:: gamera.classify NonInteractiveClassifier group_list_automatic group_and_update_list_automaticnnSaving and loadingn``````````````````nnThese functions deal with saving and loading the training data of thenclassifier to/from the <a href="#id19"><span class="problematic" id="id27">`Gamera XML format`__</span></a>.nn.. __: xml_format.htmlnn.. note:: UNCLASSIFIED glyphs in the training data are ignoredn   (neither saved or loaded).nn.. docstring:: gamera.classify NonInteractiveClassifier to_xml to_xml_filename from_xml from_xml_filename merge_from_xml merge_from_xml_filenamennnMiscellaneousn`````````````nn.. docstring:: gamera.classify NonInteractiveClassifier is_interactive get_glyphs set_glyphs merge_glyphs clear_glyphsnnInteractive classifiersn'''''''''''''''''''''''nnClassificationn``````````````nn.. docstring:: gamera.classify InteractiveClassifier classify_glyph_manual classify_list_manual classify_and_update_list_manual add_to_database remove_from_databasennDisplayn```````nn.. docstring:: gamera.classify InteractiveClassifier displaynn*k* Nearest Neighbor classifiern-------------------------------nnThe <em>k</em> Nearest Neighbor classifier is a concrete example of thenclassifier API.  It adds some methods of its own.nn``kNNNonInteractive`` has a number of advantages overn``kNNInteractive``:nn- Each feature can optionally be normalized independently to zero mean andn  unit variance. This reduces the bias toward features that generate largen  values, such as <tt class="docutils literal">area</tt>.  This normalization may change the classificationsn  that the classifier makes, however.nn- The selections and weights of the features can be optimized using a geneticn  algorithm (See <a href="#id33"><span class="problematic" id="id34">here_</span></a>).nn- The training data can be serialized to a classifier-specific binary filen  format.  This format saves and loads much faster than the Gamera XMLn  file format.nn.. note:: n   It is good practice to retain the XMLn   file, since it is portable across platforms and to future versions ofn   Gamera.  The binary format is not guaranteed to be portable.nn.. _here: ga_optimization.htmlnnFeature managementn''''''''''''''''''nnThe classifier automatically manages the generation of feature vectorsnfrom glyphs.  When a feature vector is needed because it is beingnautomatically classified or added to the training set, it isnautomatically generated on-the-fly.nnBy default, the feature generation method in kNN is quite simple.  Thenuser of the classifier provides a list of feature function namesn(either in the constructor or through the <tt class="docutils literal">change_feature_set</tt>nmethod), and for each glyph, the results of each feature function innthe set are appended together to produce a feature vector.nnThis basic feature generation method can be overridden and replacednwith something more appropriate to other problem domains.  See then`overriding kNN's feature generation`__ appendix for more information.nn.. __: overriding_knn_features.htmlnnMethods on all <tt class="docutils literal">kNN</tt> classesn''''''''''''''''''''''''''''''nn.. _kNNNonInteractive:nnkNN Initializationn``````````````````nn.. docstring:: gamera.knn kNNNonInteractive __init__nnSettingsn````````nnSettings are various parameters that control the behavior of thenclassifier. While some are only accessible through the methods given below,nthe following settings are plain properties of all kNN classifier classes:nn*num_k*n    the number <em>k</em> of neighbors to be considerednn*distance_type*n    the distance measure for neighborhood. Can be one ofn    <tt class="docutils literal">CITY_BLOCK</tt> (default), <tt class="docutils literal">EUCLIDEAN</tt> or <tt class="docutils literal">FAST_EUCLIDEAN</tt>nnn.. docstring:: gamera.knn kNNInteractive change_feature_setnn.. docstring:: gamera.knn _kNNBase get_selections_by_features get_selections_by_featuren.. docstring:: gamera.knn _kNNBase get_weights_by_features get_weights_by_featuren.. docstring:: gamera.knn _kNNBase set_selections_by_features set_selections_by_featuren.. docstring:: gamera.knn _kNNBase set_weights_by_features set_weights_by_featurenn.. docstring:: gamera.knn _kNNBase save_settings load_settingsnnSerializationn`````````````n.. docstring:: gamera.knn _kNNBase serialize unserializennEvaluationn''''''''''nn.. docstring:: gamera.knn _kNNBase evaluate knndistance_statistics distance_from_images distance_between_images distance_matrix unique_distancesnn.. _kNNInteractive:nn``kNNInteractive``n''''''''''''''''''nn.. docstring:: gamera.knn kNNInteractive __init__nn.. docstring:: gamera.knn kNNInteractive noninteractive_copynnImproving kNN Classifiers using Editingn'''''''''''''''''''''''''''''''''''''''nnGamera provides a way to improve kNN classifiers by modifying the underlyingnset of glyphs (training-set). This class of algorithms either removes bad or nredundant glyphs or even creates new <em>optimal</em> glyphs from the training-set.nnBesides the graphical user interface in the <a href="#id19"><span class="problematic" id="id28">`Classifier Display`__</span></a>, it is alsonpossible to invoke the algorithms from your script.nn.. __: gui.html#classifier-menunnEach editing algorithm is a function, that takes at least one parameter, a n*kNNInteractive* classifier - and returns a new edited <em>kNNInteractive</em> nclassifier. Any additional parameters depend on the effective algorithm, but arenoptional by convention.nnCurrently the following editing algorithms are included with Gamera:nn.. docstring:: gamera.knn_editing edit_mnnn n.. docstring:: gamera.knn_editing edit_cnn nn.. docstring:: gamera.knn_editing edit_mnn_cnnnnnUsage Examplen`````````````nnThe algorithms are located in the <em>gamera.knn_editing</em> package. So a typical nusage example employing Wilson's <em>Modified Nearest Neighbour</em> (edit_mnn) would nlook like this:nn.. code:: Pythonnn  from gamera.core import init_gameran  init_gamera()n  n  from gamera.knn import kNNInteractiven  classifier = kNNInteractive()n  classifier.from_xml_filename(&quot;training-set.xml&quot;)n  n  from gamera.knn_editing import edit_mnnn  editedClassifier = edit_mnn(classifier)nnTo display the glyphs removed by the editing algorithm, you can usenthe following code in the Gamera GUI:nn.. code:: Pythonnn   set1 = classifier.get_glyphs()n   set2 = editedClassifier.get_glyphs()n   imagelist = list(set1.difference(set2))n   display_multi(imagelist)nnnIntegrating your own editing algorithmn``````````````````````````````````````nnIf you have written your own editing algorithm and want to make it available innthe Classifier GUI, refer to the documentation of the class n**gamera.knn_editing.AlgoRegistry**.  n'</p>
<div class="system-message" id="id1">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id2">backlink</a></em></p>
Unknown interpreted text role &quot;raw-html&quot;.</div>
<div class="system-messages section">
<h1>Docutils System Messages</h1>
<div class="system-message" id="id3">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id4">backlink</a></em></p>
Undefined substitution referenced: &quot;n +==========+==============+=====================================================+n | |UColor&quot;.</div>
<div class="system-message" id="id5">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id6">backlink</a></em></p>
Undefined substitution referenced: &quot;n | (white) | | |n +----------+--------------+-----------------------------------------------------+n | |AColor&quot;.</div>
<div class="system-message" id="id7">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id8">backlink</a></em></p>
Undefined substitution referenced: &quot;n +----------+--------------+-----------------------------------------------------+n | |HColor&quot;.</div>
<div class="system-message" id="id9">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id10">backlink</a></em></p>
Undefined substitution referenced: &quot;n | (yellow) | | heuristic (non-exemplar-based) process. |n +----------+--------------+-----------------------------------------------------+n | |MColor&quot;.</div>
<div class="system-message" id="id11">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id12">backlink</a></em></p>
Undefined substitution referenced: &quot;n | (green) | | |n +----------+--------------+-----------------------------------------------------+nn.. |UColor&quot;.</div>
<div class="system-message" id="id13">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id14">backlink</a></em></p>
Undefined substitution referenced: &quot;AColor&quot;.</div>
<div class="system-message" id="id15">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id16">backlink</a></em></p>
Undefined substitution referenced: &quot;HColor&quot;.</div>
<div class="system-message" id="id17">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id18">backlink</a></em></p>
Undefined substitution referenced: &quot;MColor&quot;.</div>
<div class="system-message" id="id19">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 2); <em>backlinks: <a href="#id20">1</a>, <a href="#id21">2</a>, <a href="#id22">3</a>, <a href="#id23">4</a>, <a href="#id24">5</a>, <a href="#id25">6</a>, <a href="#id26">7</a>, <a href="#id27">8</a>, <a href="#id28">9</a></em></p>
Anonymous hyperlink mismatch: 9 references but 0 targets.
See &quot;backrefs&quot; attribute for IDs.</div>
<div class="system-message" id="id29">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id30">backlink</a></em></p>
Unknown target name: &quot;knninteractive&quot;.</div>
<div class="system-message" id="id31">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id32">backlink</a></em></p>
Unknown target name: &quot;knnnoninteractive&quot;.</div>
<div class="system-message" id="id33">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/classify.txt</tt>, line 1); <em><a href="#id34">backlink</a></em></p>
Unknown target name: &quot;here&quot;.</div>
</div>
</div>
</body>
</html>
