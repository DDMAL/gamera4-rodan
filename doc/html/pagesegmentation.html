<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.15.2: http://docutils.sourceforge.net/" />
<title>pagesegmentation.txt</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document">


<p>b'nPageSegmentationn================nn**Last modified**: November 17, 2019nn.. contents::nn.. role:: raw-html(raw)n   :format: htmln.. footer:: <a href="#id1"><span class="problematic" id="id2">:raw-html:`&lt;div style=&quot;text-align:right;&quot;&gt;For contact information, see &lt;a href=&quot;http://gamera.informatik.hsnr.de/contact.html&quot;&gt;http://gamera.informatik.hsnr.de/contact.html&lt;/a&gt;&lt;/div&gt;`</span></a>nnn``bbox_merging``n----------------nn[object] <strong>bbox_merging</strong> (int <em>Ex</em> = -1, int <em>Ey</em> = -1, int <em>iterations</em> = 2)nnn:Operates on: <tt class="docutils literal">Image</tt> [OneBit]n:Returns: [object]n:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Rene Baston, Karl MacMillan, and Christoph DalitznnnSegments a page by extending and merging the bounding boxes of thenconnected components on the page.nnHow much the segments are extended is controlled by the argumentsn*Ex* and <em>Ey</em>. Depending on their value, the returned segmentsncan be lines or paragraphs or something else.nnThe return value is a list of 'CCs' where each 'CC' represents anfound segment. Note that the input image is changed such that eachnpixel is set to its segment label.nnArguments:nn*Ex*:n  How much each CC is extended to the left and right before merging.n  When <em>-1</em>, it is set to twice the median width of all CCs.nn*Ey*:n  How much each CC is extended to the top and bottom before merging.n  When <em>-1</em>, it is set to the median height of all CCs.n  This will typically segment into paragraphs.nn  If you want to segment into lines, set <em>Ey</em> to something small liken  one sixth of the median symbol height.nn*iterations*:n  After merging intersecting bounding boxes, it can happen that then  enclosing bounding boxes of different segments still intersect.n  If you do not want this, set <em>iterations</em> &gt; 1 (two will typically ben  sufficient). If you however only want actually intersecting boundingn  boxes to be merged, set <em>iterations</em> to one.nnn``kise_block_extraction``n-------------------------nn[object] <strong>kise_block_extraction</strong> (float <em>Ta</em> = 40.00, float <em>fr</em> = 0.34)nnn:Operates on: <tt class="docutils literal">Image</tt> [OneBit]n:Returns: [object]n:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Christoph DalitznnnSegments a page into blocks by Kise's method based on the area Voronoi diagramnas described innn    K. Kise, A. Sato, M. Iwata: <em>Segmentation of Page Images Using then    Area Voronoi Diagram.</em> Computer Vision and Image Understandig 70,n    pp. 370-382, 1998nnThe return value is a list of 'CCs' where each 'CC' represents anfound segment. Note that the input image is changed such that eachnpixel is set to its segment label.nnThe algorithm first builds a CC neighborhood graph and then removes edges fromnthis graph based upon the area ratio and distance between adjacent segments.nThe criterion isnn    <em>d/Td1</em> &lt;= 1  OR  <em>d/Td2</em> + <em>A/Ta</em> &lt;= 1nnwhere <em>Td1</em> &lt; <em>Td2</em> are the two largest peaks in the CC distance distribution andnA is the area ratio of the adjacent CCs.nnArguments:nn*Ta*:n  Area ratio in the criterion above.nn*fr*:n  Fraction for determining Td2. It is not chosen as the peak position, butn  larger at the position where the peak has fallen to a fraction <em>fr</em> of itsn  height.nnn``projection_cutting``n----------------------nn[object] <strong>projection_cutting</strong> (int <em>Tx</em> = 0, int <em>Ty</em> = 0, int <em>noise</em> = 0, <tt class="docutils literal">Choice</tt> [cut|ignore] <em>gap_treatment</em> = cut)nnn:Operates on: <tt class="docutils literal">Image</tt> [OneBit]n:Returns: [object]n:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Maria Elhachimi and Robert ButznnnSegments a page with the <em>Iterative Projection Profile Cuttings</em>nmethod.nnThe image is split recursively in the horizontal and verticalndirection by looking for 'gaps' in the projection profile.  An'gap' is a contiguous sequence of projection values smaller thann*noise* pixels. The splitting is done for each gap wider or highernthan given thresholds <em>Tx</em> or <em>Ty</em>. When no further split pointsnare found, the recursion stops.nnWhether the resulting segments represent lines, columns ornparagraphs depends on the values for <em>Tx</em> and <em>Ty</em>. The returnnvalue is a list of 'CCs' where each 'CC' represents a foundnsegment. Note that the input image is changed such that each pixelnis set to its CC label.nn*Tx*:n  minimum 'gap' width in the horizontal direction.  When set ton  zero, <em>Tx</em> is set to the median height of all connectedn  component * 7, which might be a reasonable assumption for then  gap width between adjacent text columns.nn*Ty*:n  minimum 'gap' width in the vertical direction.  When set ton  zero, <em>Ty</em> is set to half the median height of all connectedn  component, which might be a reasonable assumption for the gapn  width between adjacent text lines.nn*noise*:n  maximum projection value still considered as belonging to an  'gap'.nn*gap_treatment*:n  decides how to treat gaps when <em>noise</em> is non zero.n  When 0 ('cut'), gaps are cut in the middle and the noise pixelsn  in the gap are assigned to the segments.n  When 1 ('ignore'), noise pixels within the gap are not assignedn  to a segment, in other words, they are ignored.nnn``runlength_smearing``n----------------------nn[object] <strong>runlength_smearing</strong> (int <em>Cx</em> = -1, int <em>Cy</em> = -1, int <em>Csm</em> = -1)nnn:Operates on: <tt class="docutils literal">Image</tt> [OneBit]n:Returns: [object]n:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Christoph Dalitz and Iliya StoyanovnnnSegments a page with the <em>Run Length Smearing</em> algorithm.nnThe algorithm converts white horizontal and vertical runs shorternthan given thresholds <em>Cx</em> and <em>Cy</em> to black pixels (this is thenso-called 'run length smearing').nnThe intersection of both smeared images yields the page segmentsnas black regions. As this typically still consists small whitenhorizontal gaps, these gaps narrower than <em>Csm</em> are in a finalnstep also filled out.nnThe return value is a list of 'CCs' where each 'CC' represents anfound segment. Note that the input image is changed such that eachnpixel is set to its CC label.nnArguments:nn*Cx*:n  Minimal length of white runs in the rows. When set to <em>-1</em>, itn  is set to 20 times the median height of all connectedn  components.nn*Cy*:n  Minimal length of white runs in the columns. When set to <em>-1</em>,n  it is set to 20 times the median height of all connectedn  components.nn*Csm*:n  Minimal length of white runs row-wise in the almost finaln  image. When set to <em>-1</em>, it is set to 3 times the median heightn  of all connected components.nnn``segmentation_error``n----------------------nn``IntVector`` <strong>segmentation_error</strong> (<tt class="docutils literal">Image</tt> [OneBit] <em>Gseg</em>, <tt class="docutils literal">Image</tt> [OneBit] <em>Sseg</em>)nnn:Returns: <tt class="docutils literal">IntVector</tt>n:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Christoph DalitznnnCompares a ground truth segmentation <em>Gseg</em> with a segmentation <em>Sseg</em>nand returns error count numbers.nnThe input images must be given in such a way that each segment isnuniquely labeled, similar to the output of a page segmentationnalgorithm like <a class="reference internal" href="#runlength-smearing">runlength_smearing</a>. For ground truth data, such a labelednimage can be obtained from an external color image with <a class="reference internal" href="#colors-to-labels">colors_to_labels</a>.nn.. <span class="target" id="runlength-smearing">runlength_smearing</span>: #runlength-smearingn.. <span class="target" id="colors-to-labels">colors_to_labels</span>: color.html#colors-to-labelsnnThe two segmentations are compared by building equivalence classes ofnoverlapping segments as described innn  M. Thulke, V. Margner, A. Dengel:n  <em>A general approach to quality evaluation of documentn  segmentation results.</em>n  Lecture Notes in Computer Science 1655, pp. 43-57 (1999)nnEach class is assigned an error type depending on how many ground truthnand test segments it contains. The return value is a tuplen(<em>n1,n2,n3,n4,n5,n6)</em> where each value is the total number of classesnwith the corresponding error type:nn+------+-----------------------+---------------+----------------------+n| Nr   | Ground truth segments | Test segments | Error type           <a href="#id5"><span class="problematic" id="id6">|\n+======+=======================+===============+======================+\n|</span></a> <em>n1</em> | 1                     | 1             | correct              <a href="#id7"><span class="problematic" id="id8">|\n+------+-----------------------+---------------+----------------------+\n|</span></a> <em>n2</em> | 1                     | 0             | missed segment       <a href="#id9"><span class="problematic" id="id10">|\n+------+-----------------------+---------------+----------------------+\n|</span></a> <em>n3</em> | 0                     | 1             | false positive       <a href="#id11"><span class="problematic" id="id12">|\n+------+-----------------------+---------------+----------------------+\n|</span></a> <em>n4</em> | 1                     | &gt; 1           | split                <a href="#id13"><span class="problematic" id="id14">|\n+------+-----------------------+---------------+----------------------+\n|</span></a> <em>n5</em> | &gt; 1                   | 1             | merge                <a href="#id15"><span class="problematic" id="id16">|\n+------+-----------------------+---------------+----------------------+\n|</span></a> <em>n6</em> | &gt; 1                   | &gt; 1           | splits and merges    <a href="#id3"><span class="problematic" id="id4">|</span></a>n+------+-----------------------+---------------+----------------------+nnThe total segmentation error can be computed from these numbers asn*1 - n1 / (n1 + n2 + n3 + n4 + n5 + n6)*. The individual numbers cannbe of use to determine what exactly is wrong with the segmentation.nnAs this function is not an image method, but a free function, itnis not automatically imported with all plugins and you must importnit explicitly withnn.. code:: Pythonnn      from gamera.plugins.pagesegmentation import segmentation_errornnnn``sub_cc_analysis``n-------------------nntuple <strong>sub_cc_analysis</strong> ([object <em>cclist</em>])nnn:Operates on: <tt class="docutils literal">Image</tt> [OneBit]n:Returns: tuplen:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Stephan Ruloff and Christoph DalitznnnFurther subsegments the result of a page segmentation algorithm intongroups of actual connected components.nnThe result of a page segmentation plugin is a list of 'CCs' whereneach 'CC' does not represent a 'connected component', but a pagensegment (typically a line of text). In a practical OCR applicationnyou will however need the actual connected components (whichnshould roughly correspond to the glyphs) in groups of lines. Thatnis what this plugin is meant for.nnThe input image must be an image that has been processed with anpage segmentation plugin, i.e. all pixels in the image must benlabeled with a segment label. The input parameter <em>cclist</em> is thenlist of segments returned by the page segmentation algorithm.nnThe return value is a tuple with two entries:nn- a new image with all pixels labeled according to the new CCsn- a list of ImageLists, each list containing all connected componentsn  belonging to the same page segmentsnnn.. note:: The groups will be returned in the same order as givenn      in <em>cclist</em>.  This means that you can sort the page segmentsn      by reading order before passing them to <em>sub_cc_analysis</em>.nn      Note that the order of the returned CCs within each group isn      not well defined. Hence you will generally need to sort eachn      subgroup by reading order.nnn``textline_reading_order``n--------------------------nn[object] <strong>textline_reading_order</strong> ([object <em>lineccs</em>])nnn:Returns: [object]n:Category: PageSegmentationn:Defined in: pagesegmentation.pyn:Author: Christoph DalitznnnSorts a list of Images (CCs) representing textlines by reading order andnreturns the sorted list. Incidentally, this will not only work onntextlines, but also on paragraphs, but <em>not</em> on actual Connected nComponents.nnThe algorithm sorts all lines in topological order, based onnthe following criteria for the pairwise order of two lines:nn- line <em>a</em> comes before line <em>b</em> when <em>a</em> is totally to the leftn  of <em>b</em> (order &quot;column before row&quot;)nn- line <em>a</em> comes before <em>b</em> when both overlap horizontally andn  <em>a</em> is above <em>b</em> (order within a column)nnIn the reference <a href="#id17"><span class="problematic" id="id18">`&quot;High Performance Document Analysis&quot;`__</span></a>nby T.M. Breuel (Symposium on Document Image Understanding,nUSA, pp. 209-218, 2003),nan additional constraint is made for the first criterion by demandingnthat no other segment may be between <em>a</em> and <em>b</em> that overlapsnhorizontally with both. This constraint for taking multi columnnheadings that interrupt columns into account is replaced in thisnimplementation with an a priori sort of all textlines by <em>y</em>-position.nThis results in a preference of rows over columns (in case of ambiguity)nin the depth-first-search utilized in the topological sorting.nn.. __: <a class="reference external" href="http://iupr1.cs.uni-kl.de/~shared/publications/2003-breuel-sdiut-high-performance-doc-layout-analysis.pdfnnAs">http://iupr1.cs.uni-kl.de/~shared/publications/2003-breuel-sdiut-high-performance-doc-layout-analysis.pdfnnAs</a> this function is not an image method, but a free function, itnis not automatically imported with all plugins and you must importnit explicitly withnn.. code:: Pythonnn  from gamera.plugins.pagesegmentation import textline_reading_ordernnn'</p>
<div class="system-message" id="id1">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id2">backlink</a></em></p>
Unknown interpreted text role &quot;raw-html&quot;.</div>
<div class="system-message" id="id3">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id4">backlink</a></em></p>
Inline substitution_reference start-string without end-string.</div>
<div class="system-messages section">
<h1>Docutils System Messages</h1>
<div class="system-message" id="id5">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id6">backlink</a></em></p>
Undefined substitution referenced: &quot;n+======+=======================+===============+======================+n&quot;.</div>
<div class="system-message" id="id7">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id8">backlink</a></em></p>
Undefined substitution referenced: &quot;n+------+-----------------------+---------------+----------------------+n&quot;.</div>
<div class="system-message" id="id9">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id10">backlink</a></em></p>
Undefined substitution referenced: &quot;n+------+-----------------------+---------------+----------------------+n&quot;.</div>
<div class="system-message" id="id11">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id12">backlink</a></em></p>
Undefined substitution referenced: &quot;n+------+-----------------------+---------------+----------------------+n&quot;.</div>
<div class="system-message" id="id13">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id14">backlink</a></em></p>
Undefined substitution referenced: &quot;n+------+-----------------------+---------------+----------------------+n&quot;.</div>
<div class="system-message" id="id15">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 1); <em><a href="#id16">backlink</a></em></p>
Undefined substitution referenced: &quot;n+------+-----------------------+---------------+----------------------+n&quot;.</div>
<div class="system-message" id="id17">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">./src/pagesegmentation.txt</tt>, line 2); <em><a href="#id18">backlink</a></em></p>
Anonymous hyperlink mismatch: 1 references but 0 targets.
See &quot;backrefs&quot; attribute for IDs.</div>
</div>
</div>
</body>
</html>
